<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="icon" href="img/favicon.png" type="image/png">
        <title>ChazUN</title>
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="vendors/linericon/style.css">
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <link rel="stylesheet" href="vendors/owl-carousel/owl.carousel.min.css">
        <link rel="stylesheet" href="vendors/lightbox/simpleLightbox.css">
        <link rel="stylesheet" href="vendors/nice-select/css/nice-select.css">
        <link rel="stylesheet" href="vendors/animate-css/animate.css">
        <link rel="stylesheet" href="vendors/flaticon/flaticon.css">
        <!-- main css -->
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/responsive.css">
    </head>
    <body>

    <nav class="navbar navbar-expand-lg navbar-dark " style="background-color: #4dabff ; height: 6em">
        <a class="navbar-brand" href="#">ChazUN - Administradores</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarText">
          <ul class="navbar-nav mr-auto">

          </ul>
          <span class="navbar-text">
          	<li class="nav-item"  style='list-style-type: none; padding-right:1em'><a href="#" class="tickets_btn">Explorar</a></li>
          </span>
          <span class="navbar-text">
            <li class="nav-item" style='list-style-type: none;'><a href="#" class="tickets_btn">Mis chazas</a></li>
          </span>

          <li style='list-style-type: none;' class="nav-item submenu dropdown">
          <a id='uname' style='color: white;'href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
          <ul class="dropdown-menu dropdown-menu-right">
          <li class="nav-item"><a class="nav-link" href="#">Perfil</a>
          <li class="nav-item"><a onclick="cerrarSesion()" class="nav-link" href="#">Cerrar sesión</a>
          </ul>
          </li>

        </div>
      </nav>

        <!--================Header Menu Area =================-->

        <section id='landing' class="home_banner_area" style='height: 900px !important;
        background-image: -webkit-linear-gradient(0deg, white 0%,  white  100%);'>

        <section class="price_area p_120">
          <div class="container">
            <div class="main_title">
              <h2>Registra tu chaza</h2>
              <p>Podras añadir tu negocio a ChazUN para que los usuarios puedan acceder a información como horarios, precios y productos. Los usuarios podrán calificar y comentar tu negocio</p>
                <a onclick="iniciarRegistro()" class="main_btn center-block" style='margin-top:2em' href="#">Crear negocio</a>
            </div>
            <hr />

            <div class="price_inner row"  style='margin-top:5em;'>
              <div class="col-lg-4">
                <div class="price_item">
                  <div class="price_head">
                    <h4>Real Basic</h4>
                  </div>
                  <div class="price_body">
                    <ul class="list">
                      <li><a href="#">2.5 GB Space</a></li>
                      <li><a href="#">Secure Online Transfer</a></li>
                      <li><a href="#">Unlimited Styles</a></li>
                      <li><a href="#">Customer Service</a></li>
                    </ul>
                  </div>
                  <div class="price_footer">
                    <h3><span class="dlr">$</span> 39 <span class="month">Per <br />Month</span></h3>
                    <a class="main_btn" href="#">Get Started</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        </section>

        <!--================End Footer Area =================-->


        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="js/jquery-3.2.1.min.js"></script>
        <script src="js/popper.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/stellar.js"></script>
        <script src="vendors/lightbox/simpleLightbox.min.js"></script>
        <script src="vendors/nice-select/js/jquery.nice-select.min.js"></script>
        <script src="js/jquery.ajaxchimp.min.js"></script>
        <script src="vendors/counter-up/jquery.waypoints.min.js"></script>
        <script src="vendors/counter-up/jquery.counterup.min.js"></script>
        <!--gmaps Js-->
        <script src="js/theme.js"></script>

        <div id="ingModal" class="modal modal-message fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <i class="fa fa-close"></i>
                        </button>
                        <h2>Registar un negocio</h2>
                          <form class="row contact_form" action="" method="post" id="contactForm" novalidate="novalidate">
                              <div class="col-md-12 text-center">
                                  <div class="form-group">
                                      <input type="nombre" class="form-control" id="nombreval" name="nombre" placeholder="Nombre del negocio">
                                  </div>
                                  <div class="form-group">
                                      <input type="descripcion" class="form-control" id="descripcionval" name="descripcion" placeholder="Descripcion">
                                  </div>
                                  <div class="form-group">
                                      <input type="horario" class="form-control" id="horarioval" name="horario" placeholder="Horario de atención">
                                  </div>
                                  <div class="form-group">
                                      <input type="celular" class="form-control" id="celularval" name="celular" placeholder="Numero de contacto">
                                  </div>
                              </div>

                              <div class="col-md-12 text-center">
                                  <button  onclick="crearNegocio()"  type="button" value="submit" class="btn submit_btn">Registrar negocio</button>
                              </div>
                          </form>
                    </div>
                </div>
            </div>
        </div>


        <div id="success" class="modal modal-message fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <i class="fa fa-close"></i>
                        </button>
                        <h2>Correcto</h2>
                        <p>El negocio ha sido registrado</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="error" class="modal modal-message fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <i class="fa fa-close"></i>
                        </button>
                        <h2>Lo sentimos !</h2>
                        <p>Algo salio mal</p>
                        <p id='errormsg'></p>
                    </div>
                </div>
            </div>
        </div>


    </body>
</html>

<script>
var usuario;
$( document ).ready(function() {
  usuario = localStorage.getItem("usuario");
  console.log(JSON.parse(usuario));
  usuario = JSON.parse(usuario);
  if(usuario==null || usuario == undefined){
     window.location.replace('index.html')
  }

  $('#uname').html(usuario.nombre+' '+usuario.apellido.charAt(0)+'.');


});

function cerrarSesion(){
  localStorage.removeItem("usuario");
  window.location.replace('index.html')
}

function iniciarRegistro(){
  $('#ingModal').modal('show');
}

function crearNegocio(){
  var nombre =$('#nombreval').val();
  var descripcion =  $('#descripcionval').val();
  var celular =  $('#celularval').val();
  var horario =  $('#horarioval').val();
  var lat =0;
  var lng =0;

  $('#errormsg').html();

  var xhr;
  xhr = $.ajax({

      url: "http://localhost:3001/nuevonegocio",
      type: "POST",
      async: true, // set to false if you don't mind the page pausing while waiting for response
      cache: false,
      dataType: "json",
      data: JSON.stringify({administrador: usuario.nombre+' '+usuario.apellido,
      nombre: nombre, descripcion: descripcion, celular: celular, horario:horario, latitud: lat, longitud:lng }),
      contentType: "application/json; charset=utf-8",
      success: function(data) {
          console.log(data);
          if(data.validado== 'ok'){
            $('#ingModal').modal('hide');
            $('#success').modal('show');
          }
          else{
            $('#ingModal').modal('hide');
            $('#error').modal('show');
            $('#errormsg').html(data.error);
          }
          // handle your successful response here
      },
      error: function(xhr, ajaxOptions, thrownError) {
          $('#ingModal').modal('hide');
          $('#error').modal('show');
          // handle your fail response here
      }
  });
   xhr.setRequestHeader("Access-Control-Allow-Origin: *");

  return xhr;
}

</script>
