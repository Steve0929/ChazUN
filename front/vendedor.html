<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="icon" href="img/favicon.png" type="image/png">
        <title>ChazUN</title>
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="vendors/linericon/style.css">
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <link rel="stylesheet" href="vendors/owl-carousel/owl.carousel.min.css">
        <link rel="stylesheet" href="vendors/lightbox/simpleLightbox.css">
        <link rel="stylesheet" href="vendors/nice-select/css/nice-select.css">
        <link rel="stylesheet" href="vendors/animate-css/animate.css">
        <link rel="stylesheet" href="vendors/flaticon/flaticon.css">
        <!-- main css -->
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/responsive.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
body{
  -webkit-font-smoothing: antialiased;
}
.rowComent{
border-color: rgb(77, 171, 255) !important;
border-radius: 5px;
border: 1px solid;
margin: 2em;
}
/* - - - - - RATINGS */
.rating {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 150px;
  height: 30px;
  padding: 5px 10px;
  margin: auto;
  border-radius: 30px;
  background: #FFF;
  display: block;
  overflow: hidden;
  top: 3em;
  right: 30em;
  width: 13em;
  height: 35px;


  box-shadow: 0 1px #CCC,
              0 5px #DDD,
              0 9px 6px -3px #999;

  unicode-bidi: bidi-override;
  direction: rtl;
}
.rating:not(:checked) > input {
  display: none;
}

/* - - - - - RATE */
#rate {
  top: -65px;
}
#rate:not(:checked) > label {
  cursor:pointer;
  float: right;
  width: 30px;
  height: 30px;
  display: block;

  color: rgba(0, 135, 211, .4);
  line-height: 33px;
  text-align: center;
}
#rate:not(:checked) > label:hover,
#rate:not(:checked) > label:hover ~ label {
  color: rgba(0, 135, 211, .6);
}
#rate > input:checked + label:hover,
#rate > input:checked + label:hover ~ label,
#rate > input:checked ~ label:hover,
#rate > input:checked ~ label:hover ~ label,
#rate > label:hover ~ input:checked ~ label {
  color: rgba(0, 135, 211, .8);
}
#rate > input:checked ~ label {
  color: rgb(0, 135, 211);
}
/* - - - - - LIKE */
#like {
  bottom: -65px;
}
#like:not(:checked) > label {
  cursor:pointer;
  float: right;
  width: 30px;
  height: 30px;
  display: block;

  color: rgba(233, 54, 40, .4);
  line-height: 33px;
  text-align: center;
}
#like:not(:checked) > label:hover,
#like:not(:checked) > label:hover ~ label {
  color: rgba(233, 54, 40, .6);
}
#like > input:checked + label:hover,
#like > input:checked + label:hover ~ label,
#like > input:checked ~ label:hover,
#like > input:checked ~ label:hover ~ label,
#like > label:hover ~ input:checked ~ label {
  color: rgba(233, 54, 40, .8);
}
#like > input:checked ~ label {
  color: rgb(233, 54, 40);
}

.proof {
  bottom: -65px;
}
.proof:not(:checked) > label {
  cursor:pointer;
  float: right;
  width: 30px;
  height: 30px;
  display: block;

  color: rgba(233, 54, 40, .4);
  line-height: 33px;
  text-align: center;
}
.proof:not(:checked) > label:hover,
.proof:not(:checked) > label:hover ~ label {
  color: rgba(233, 54, 40, .6);
}
.proof > input:checked + label:hover,
.proof > input:checked + label:hover ~ label,
.proof > input:checked ~ label:hover,
.proof > input:checked ~ label:hover ~ label,
.proof > label:hover ~ input:checked ~ label {
  color: rgba(233, 54, 40, .8);
}
.proof > input:checked ~ label {
  color: rgb(233, 54, 40);
}

</style>
    </head>
    <body>

    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background-color: #4dabff ; height: 6em">
        <a class="navbar-brand" href="#">ChazUN - Vendedores</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarText">
          <ul class="navbar-nav mr-auto">

          </ul>
          <span class="navbar-text">
          	<li class="nav-item"  style='list-style-type: none; padding-right:1em'><a href="explorar.html" class="tickets_btn">Explorar</a></li>
          </span>
          <span class="navbar-text">
            <li class="nav-item" style='list-style-type: none;'><a href="#cha" class="tickets_btn">Mis chazas</a></li>
          </span>

          <li style='list-style-type: none;' class="nav-item submenu dropdown">
          <a id='uname' style='color: white;'href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
          <ul class="dropdown-menu dropdown-menu-right">

          <li class="nav-item"><a onclick="cerrarSesion()" class="nav-link" href="#">Cerrar sesión</a>
          </ul>
          </li>

        </div>
      </nav>

        <!--================Header Menu Area =================-->

        <section id='landing' class="home_banner_area" style='height: 900px !important;
        background-image: -webkit-linear-gradient(0deg, white 0%,  white  100%);'>

        <section class="price_area p_120">
          <div  class="container">
        <!--    <div class="main_title">
              <h2>Registra tu chaza</h2>
              <p>Podras añadir tu negocio a ChazUN para que los usuarios puedan acceder a información como horarios, precios y productos. Los usuarios podrán calificar y comentar tu negocio</p>
                <a onclick="iniciarRegistro()" class="main_btn center-block" style='margin-top:2em' href="#">Crear negocio</a>
            </div> -->
            <hr id='cha'/>
            <div id='noChazas'></div>
            <div  id='chazasofuser' class="price_inner row"  style='margin-top:5em;'>


            </div>



          </div>
        </section>

        </section>

        <!--================End Footer Area =================-->


        <div id="ingModal" class="modal modal-message fade" role="dialog" style='height: 40em;'>
          <!-- height: 50em;max-width: 50em;overflow-x: hidden;overflow-y: scroll;top:25em;-->
            <div class="modal-dialog" style='max-width: 45em;padding-top: 40em;'>
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <i class="fa fa-close"></i>
                        </button>
                        <h2>Registar un negocio</h2>
                          <form class="row contact_form" action="" method="post" id="contactForm" novalidate="novalidate">
                              <div class="col-md-12 text-center">
                                  <div class="form-group" style='padding-bottom:3em'>
                                    <select  id="cate" >
                                    <option value='Alimentos'>Alimentos</option>
                                    <option value='Papeleria'>Papeleria</option>
                                    <option value='Elementos electrónicos'>Elementos electrónicos</option>
                                    <option value='Accesorios'>Accesorios</option>
                                    <option value='Material audiovisual'>Material audiovisual</option>
                                    <option value='Otros'>Otros</option>
                                    </select>
                                  </div>
                                  <div class="form-group">
                                      <input type="nombre" class="form-control" id="nombreval" name="nombre" placeholder="Nombre del negocio">
                                  </div>
                                  <div class="form-group">
                                      <input type="descripcion" class="form-control" id="descripcionval" name="descripcion" placeholder="Descripcion">
                                  </div>
                                  <div class="form-group">
                                      <input type="horario" class="form-control" id="horarioval" name="horario" placeholder="Horario de atención">
                                  </div>
                                  <div class="form-group">
                                      <input type="celular" class="form-control" id="celularval" name="celular" placeholder="Numero de contacto">
                                  </div>
                              </div>
                          </form>
                         <div id="map" class="mapBox" style='margin-top:1em'></div>
                          <div class="col-md-12 text-center">
                              <button  onclick="crearNegocio()"  type="button" value="submit" class="btn submit_btn">Registrar negocio</button>
                          </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="success" class="modal modal-message fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <i class="fa fa-close"></i>
                        </button>
                        <h2>Correcto</h2>
                        <p>El negocio ha sido registrado</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="error" class="modal modal-message fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <i class="fa fa-close"></i>
                        </button>
                        <h2>Lo sentimos !</h2>
                        <p>Algo salio mal</p>
                        <p id='errormsg'></p>
                    </div>
                </div>
            </div>
        </div>

        <div id="modalComentarios" class="modal modal-message fade" role="dialog" style='top: 0em;height: 40em;'>
          <div class="modal-dialog" style='max-width: 60em;padding-top: 40em;'>
              <div class="modal-content">
                  <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <i class="fa fa-close"></i>
                      </button>
                      <h2>Lo que los usuarios estan diciendo de tu negocio</h2>

          <div id='comentarios'></div>
        </div>


                  </div>
              </div>
          </div>


<div id="modalProductos" class="modal modal-message fade" role="dialog" style='top: 0em;height: 40em;'>
  <div class="modal-dialog" style='max-width: 45em;padding-top: 40em;'>
      <div class="modal-content">
          <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <i class="fa fa-close"></i>
              </button>
              <h2>Administrar productos</h2>
              <div id='existingProducts'></div>
                <form style='padding-top:1em' class="row contact_form" action="" method="post" id="csda" novalidate="novalidate">
                    <div class="col-md-12 text-center">
                      <div class="input-group">
  <input style="width:50%;margin-right: 1em; " class="form-control " id="productoNuevo" placeholder="Producto"  name="productoNuevo" type="text" />
  <input style="width:30% " class="form-control " id="precioNuevo" placeholder="Precio"  name="precioNuevo" type="text" />
  </div>
                </form>
                <div class="col-md-12 text-center">
                    <button  onclick="guardarProductos()"  type="button" value="submit" class="btn submit_btn">Agregar producto</button>
                </div>
          </div>
      </div>
  </div>
 </div>
</div>

<div id="modalEditar" class="modal modal-message fade" role="dialog" style='height: 40em;'>
  <!-- height: 50em;max-width: 50em;overflow-x: hidden;overflow-y: scroll;top:25em;-->
    <div class="modal-dialog" style='max-width: 45em;padding-top: 40em;'>
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i class="fa fa-close"></i>
                </button>
                <h2>Editando la información de tu negocio</h2>
                  <form class="row contact_form" action="" method="post" id="contactForm" novalidate="novalidate">
                      <div class="col-md-12 text-center">
                        <!--  <div class="form-group" style='padding-bottom:3em'>
                            <select  id="catee" name="editSelect">
                            <option value='Alimentos'>Alimentos</option>
                            <option value='Papeleria'>Papeleria</option>
                            <option value='Elementos electrónicos'>Elementos electrónicos</option>
                            <option value='Accesorios'>Accesorios</option>
                            <option value='Material audiovisual'>Material audiovisual</option>
                            <option value='Otros'>Otros</option>
                            </select>
                          </div> -->
                          <div class="form-group">
                              <input type="nombre" class="form-control" id="nombrevale" name="nombre" placeholder="Nombre del negocio">
                          </div>
                          <div class="form-group">
                              <input type="descripcion" class="form-control" id="descripcionvale" name="descripcion" placeholder="Descripcion">
                          </div>
                          <div class="form-group">
                              <input type="horario" class="form-control" id="horariovale" name="horario" placeholder="Horario de atención">
                          </div>
                          <div class="form-group">
                              <input type="celular" class="form-control" id="celularvale" name="celular" placeholder="Numero de contacto">
                          </div>
                      </div>
                  </form>
                 <!-- <div id="map" class="mapBox" style='margin-top:1em'></div> -->
                  <div class="col-md-12 text-center">
                      <button  onclick="updateChaza()"  style="margin-top:2em" type="button" value="submit" class="btn submit_btn">Actualizar la información</button>
                  </div>
            </div>
        </div>
    </div>
</div>

<div id="modalVendedores" class="modal modal-message fade" role="dialog" style='top: 0em;height: 40em;'>
  <div class="modal-dialog" style='max-width: 45em;padding-top: 40em;'>
      <div class="modal-content">
          <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <i class="fa fa-close"></i>
              </button>
              <h2>Gestionar vendedores de tu negocio</h2>
              <div id='existingVendedores'></div>
                <form style='padding-top:1em' class="row contact_form" action="" method="post" id="csda" novalidate="novalidate">
                    <div class="col-md-12 text-center">
                      <div class="input-group">
  <input style="width:90%;margin-right: 1em; " class="form-control " id="emailVendedor" placeholder="Añade el correo del vendedor para agregarlo"  name="emailVendedor" type="text" />
  </div>
                </form>
                <div class="col-md-12 text-center">
                    <button  onclick="agregarVendedor()"  type="button" value="submit" class="btn submit_btn">Agregar vendedor</button>
                </div>
          </div>
      </div>
  </div>
 </div>
</div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="js/jquery-3.2.1.min.js"></script>
<script src="js/popper.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/stellar.js"></script>
<script src="vendors/lightbox/simpleLightbox.min.js"></script>
<script src="vendors/nice-select/js/jquery.nice-select.min.js"></script>
<script src="js/jquery.ajaxchimp.min.js"></script>
<script src="vendors/counter-up/jquery.waypoints.min.js"></script>
<script src="vendors/counter-up/jquery.counterup.min.js"></script>
<script src="js/theme.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    </body>
</html>


<script>
var url = 'http://localhost:3001';
//var url = '';
var usuario;
var chazas;
var lat;
var lng;
var globalIndex;

$( document ).ready(function() {
  usuario = localStorage.getItem("usuario");
  console.log(JSON.parse(usuario));
  usuario = JSON.parse(usuario);
  if(usuario==null || usuario == undefined){
     window.location.replace('index.html')
  }

  $('#uname').html(usuario.nombre+' '+usuario.apellido.charAt(0)+'.');
  getchazasofuser();

  $('#modalComentarios').on('hidden.bs.modal', function () {
      $('#comentarios').empty();
    })

});

function getHeartValue(val){
  console.log(val);
}

function mapChazas(){
  var theIndex = 0;
  console.log(chazas);
  $('#chazasofuser').empty();
  chazas.forEach(chaza=>{
    if(chaza.calificacion == null || chaza.calificacion == undefined || chaza.calificacion == '0'){
       var score = 'n/a'
    }
    else{
      score = chaza.calificacion
    }
    $('#chazasofuser').append('<div id='+chaza._id+' style="padding-left: 11em;margin-bottom: 3em;"'+
    'class="col-lg-12"><div style="width: 60em;height: 31em;" class="price_item"><div class="price_head">'+
    '<h4>'+chaza.nombre+
    '<a style="left: 9em;position: absolute;" onClick="updateChazaModal(\'' + theIndex + '\')" href="#">'+
    '<span style="color:#FDC830" class="fa fa-1x fa-pencil"></a></span>'+
    '</h4></div>'+
    '<div class="price_body"><ul class="list" style="text-align: justify;margin: 2em;"><li>'+
    '<a href="#"><b>Contacto: </b>'+chaza.celular+'</a></li><li><a href="#">'+
    '<b>Horario: </b>'+chaza.horario+'</a></li><li><a href="#">'+
    '<b>Descripcion: </b>'+chaza.descripcion+'</a></li><li><a href="#">'+
    '<b>Categoria: </b>'+chaza.categoria+'</a></li><li><a href="#">'+
    '<b>Administrador: </b>'+chaza.administrador+'</a></li><li><a style="color:white" class="main_btn" '+
    'onClick="manageProducts(\'' + theIndex + '\')" href="#">Administrar productos</a>'+
    '</li>'+
    '</ul></div>'+
    '<div style="margin:-22em auto 40px;margin-left: 35em !important;"class="price_footer"><h3><span class="dlr">'+
    '</span> '+score+' <span class="month">Basado en '+chaza.totalCalificaciones+'<br />Calificaciones</span></h3>'+
    '<a class="main_btn" onClick="openComentarios(\'' + theIndex + '\')" href="#">Ver comentarios</a></span></div></div></div>');
    theIndex++;
  })
}

//background-image:linear-gradient(to left, #F37335 0%, #FDC830 48%, #F37335 100%)

function manageVendedoresModal(index){
  globalIndex = index;
  var ch = chazas[globalIndex];
  $('#existingVendedores').empty();
  var vendedorIndex = 0;
  chazas[index].vendedores.forEach(vendedor=>{
    $('#existingVendedores').append('<ul class="list-group" style="padding-bottom:1em"><li  class="list-group-item d-flex justify-content-between align-items-center"><i class="fa fa-user-circle-o" style="font-size:24px"></i><div style="margin-right:28em">'+vendedor.nombre+" "+vendedor.apellido+'</div><a onClick="deleteVendedor(\'' + vendedorIndex + '\')" href="#"><i style="color:red" class="fa fa-trash"></i></a></li></ul>');
    vendedorIndex++;
  })

  $('#modalVendedores').modal('show');

}

function reloadVendedores(vendedores){
  var vendedorIndex = 0;
  $('#existingVendedores').empty();
  vendedores.forEach(vendedor=>{
      $('#existingVendedores').append('<ul class="list-group" style="padding-bottom:1em"><li  class="list-group-item d-flex justify-content-between align-items-center"><i class="fa fa-user-circle-o" style="font-size:24px"></i><div style="margin-right:28em">'+vendedor.nombre+" "+vendedor.apellido+'</div><a onClick="deleteVendedor(\'' + vendedorIndex + '\')" href="#"><i style="color:red" class="fa fa-trash"></i></a></li></ul>');
    vendedorIndex++;
  })

}

function deleteVendedor(index){
  var id= chazas[globalIndex]._id;
  console.log(index);
  var xhr;
  xhr = $.ajax({
      url: url+"/removerVendedor",
      type: "POST",
      async: true, // set to false if you don't mind the page pausing while waiting for response
      cache: false,
      dataType: "json",
      data: JSON.stringify({id:id, index:index}),
      contentType: "application/json; charset=utf-8",
      success: function(data) {
          console.log(data);
          if(data.removido== 'ok'){
             reloadVendedores(data.vendedores);
             getchazasofuser();
             toastr.success('El vendedor ha sido eliminado');
          }
          else{
            $('#error').modal('show');
          }
          // handle your successful response here
      },
      error: function(xhr, ajaxOptions, thrownError) {
          $('#error').modal('show');
          // handle your fail response here
      }
  });
   xhr.setRequestHeader("Access-Control-Allow-Origin: *");

  return xhr;

}

function agregarVendedor(){
  var vendedorMail = $('#emailVendedor').val();
  var aid = chazas[globalIndex]._id;
  console.log('añadir')
  xhr = $.ajax({
      url: url+"/addVendedor",
      type: "POST",
      async: true, // set to false if you don't mind the page pausing while waiting for response
      cache: false,
      dataType: "json",
      data: JSON.stringify({email:vendedorMail, id:aid}),
      contentType: "application/json; charset=utf-8",
      success: function(data) {
          console.log(data);
          if(data.añadido== 'ok'){
            reloadVendedores(data.vendedores);
            getchazasofuser();
            toastr.success('El vendedor ha sido añadido');
          }
          else{
            $('#modalVendedores').modal('hide');
            toastr.error('El correo ingresado no se encuentra registrado');
            $('#error').modal('show');
          }
          // handle your successful response here
      },
      error: function(xhr, ajaxOptions, thrownError) {
          $('#modalVendedores').modal('hide');
          $('#error').modal('show');
          // handle your fail response here
      }
  });
   xhr.setRequestHeader("Access-Control-Allow-Origin: *");

  return xhr;

}

function updateChazaModal(index){
  globalIndex = index;
  var ch = chazas[index];
  $('#nombrevale').val(ch.nombre);
  $('#descripcionvale').val(ch.descripcion);
  $('#celularvale').val(ch.celular);
  $('#horariovale').val(ch.horario);
  $('select#catee').val(ch.categoria);

  $('#modalEditar').modal('show');

}

function updateChaza(){
  var aid = chazas[globalIndex]._id;
  var nombre =$('#nombrevale').val();
  var descripcion =  $('#descripcionvale').val();
  var celular =  $('#celularvale').val();
  var horario =  $('#horariovale').val();
  var categoria = $('#catee').val();
  console.log('Actualizar');

  var xhr;
  xhr = $.ajax({

      url: url+"/updateChaza",
      type: "POST",
      async: true, // set to false if you don't mind the page pausing while waiting for response
      cache: false,
      dataType: "json",
      data: JSON.stringify({nombre: nombre, descripcion: descripcion, celular: celular, horario:horario, id:aid}),
      contentType: "application/json; charset=utf-8",
      success: function(data) {
          console.log(data);
          if(data.updated== 'ok'){
            getchazasofuser();
            $('#modalEditar').modal('hide');
            $('#success').modal('show');
            toastr.success('La información ha sido actualizada');
          }
          else{
            $('#modalEditar').modal('hide');
            $('#error').modal('show');
          }
          // handle your successful response here
      },
      error: function(xhr, ajaxOptions, thrownError) {
          $('#modalEditar').modal('hide');
          $('#error').modal('show');
          // handle your fail response here
      }
  });
   xhr.setRequestHeader("Access-Control-Allow-Origin: *");

  return xhr;
}




function openComentarios(chazaIndex){

 chazas[chazaIndex].comentarios.forEach(comentario=>{
   var isChecked1 = '';
   var isChecked2 = '';
   var isChecked3 = '';
   var isChecked4 = '';
   var isChecked5 = '';
   if(comentario.calificacion == 1){
      isChecked1 = 'checked';
   }
   else if(comentario.calificacion == 2){
      isChecked2 = 'checked';
   }
   else if(comentario.calificacion == 3){
      isChecked3 = 'checked';
      console.log(isChecked3)
   }
   else if(comentario.calificacion == 4){
      isChecked4 = 'checked';
   }
   else if(comentario.calificacion == 5){
      isChecked5 = 'checked';
   }
  console.log(isChecked1,isChecked2,isChecked3,isChecked4,isChecked5)
   var inyect = '<article class="row rowComent" style="   height: 15em;">'+
               '<div class="col-md-2 col-sm-2 hidden-xs" style="margin-top:3em">'+
             '<figure class="thumbnail">'+
              '<img class="img-responsive" src="user.png" width="48em" height="48em"/>'+
              '<figcaption class="text-center">Cliente</figcaption>'+
            '</figure>'+
           '</div>'+
           '<div class="col-md-10 col-sm-10"  style="margin-top:2em">'+
             '<div class="panel panel-default arrow left">'+
               '<div class="panel-body">'+
                 '<header class="text-left">'+
                   '<div class="comment-user"><i class="fa fa-user"></i> '+comentario.autor+'</div>'+
                   '<time class="comment-date" ><i class="fa fa-clock-o"></i>'+comentario.timeStamp+'</time>'+
                 '</header>'+
                 '<div style="border-top-left-radius:0px;text-align: justify;" class="comment-post" >'+
                  '<p>'+
                     comentario.comentario+
                   '</p>'+
                '</div>'+

               '<section id='+comentario.timeStamp+' class="rating proof">'+

              '<input   type="radio" '+isChecked5+' id="heart_5'+comentario.timeStamp+'"  name="like'+comentario.timeStamp+'" value="5"  disabled onchange="getHeartValue(this.value)"/>'+
               '<label for="heart_5" title="Five">&#10084;</label>'+

              '<input   type="radio" '+isChecked4+' id="heart_4'+comentario.timeStamp+'"  name="like'+comentario.timeStamp+'" value="4" disabled onchange="getHeartValue(this.value)"/>'+
               '<label for="heart_4" title="Four">&#10084;</label>'+

               '<input  type="radio"  '+isChecked3+' id="heart_3'+comentario.timeStamp+'" name="like'+comentario.timeStamp+'" value="3" disabled onchange="getHeartValue(this.value)"/>'+
               '<label for="heart_3" title="Three">&#10084;</label>'+

               '<input  type="radio"  '+isChecked2+' id="heart_2'+comentario.timeStamp+'" name="like'+comentario.timeStamp+'" value="2" disabled onchange="getHeartValue(this.value)"/>'+
               '<label for="heart_2" title="Two">&#10084;</label>'+

               '<input type="radio"  '+isChecked1+' id="heart_1'+comentario.timeStamp+'" name="like'+comentario.timeStamp+'" value="1" disabled onchange="getHeartValue(this.value)"/>'+
               '<label for="heart_1" title="One">&#10084;</label>'+
               '</section>'+

               '</div>'+
            '</div>'+
           '</div>'+
         '</article>'

  $('#comentarios').append(inyect);

 })


 $('#modalComentarios').modal('show');
}

function guardarProductos(){
  var nuevoProducto = $('#productoNuevo').val();
  var nuevoPrecio =  $('#precioNuevo').val();
  var id = chazas[globalIndex]._id;
  var xhr;
  xhr = $.ajax({
      url: url+"/nuevoProducto",
      type: "POST",
      async: true, // set to false if you don't mind the page pausing while waiting for response
      cache: false,
      dataType: "json",
      data: JSON.stringify({id:id,producto:nuevoProducto,precio:nuevoPrecio}),
      contentType: "application/json; charset=utf-8",
      success: function(data) {
          console.log(data);
          if(data.añadido== 'ok'){
             reloadProducts(data.productos);
             getchazasofuser();
             toastr.success('El producto ha sido añadido');

          }
          else{
            $('#modalProductos').modal('hide');
            $('#error').modal('show');
          }
          // handle your successful response here
      },
      error: function(xhr, ajaxOptions, thrownError) {
          $('#modalProductos').modal('hide');
          $('#error').modal('show');
          // handle your fail response here
      }
  });
   xhr.setRequestHeader("Access-Control-Allow-Origin: *");

  return xhr;


}

function deleteChaza(chazaIndex){
  var id = chazas[chazaIndex]._id;
  var xhr;
  xhr = $.ajax({
      url: url+"/removeChaza",
      type: "POST",
      async: true, // set to false if you don't mind the page pausing while waiting for response
      cache: false,
      dataType: "json",
      data: JSON.stringify({id:id}),
      contentType: "application/json; charset=utf-8",
      success: function(data) {
          console.log(data);
          if(data.removido== 'ok'){
            getchazasofuser();
          }
          else{
            $('#errormsg').html(data.error);
            $('#error').modal('show');
          }
          // handle your successful response here
      },
      error: function(xhr, ajaxOptions, thrownError) {
          $('#error').modal('show');
          // handle your fail response here
      }
  });
   xhr.setRequestHeader("Access-Control-Allow-Origin: *");

  return xhr;

}

//"manageProducts('+chaza.productos+','+chaza._id+')"
function manageProducts(chazaIndex){
  console.log(chazaIndex);
  //chaza = JSON.parse(chaza);
  $('#existingProducts').empty();
  var productIndex = 0;
  chazas[chazaIndex].productos.forEach(product=>{
    $('#existingProducts').append('<ul class="list-group" style="padding-bottom:1em"><li  class="list-group-item d-flex justify-content-between align-items-center">'+product.producto+'<span style="margin-left: 46em;position:absolute" class="badge badge-success badge-pill">$'+product.precio+'</span><a onClick="deleteProduct(\'' + productIndex + '\')" href="#"><i style="color:red" class="fa fa-trash"></i></a></li></ul>');
    productIndex++;
  })
  $('#modalProductos').modal('show');
  globalIndex = chazaIndex;
}

function reloadProducts(productos){
  var productIndex = 0;
  $('#existingProducts').empty();
  productos.forEach(product=>{
    $('#existingProducts').append('<ul class="list-group" style="padding-bottom:1em"><li  class="list-group-item d-flex justify-content-between align-items-center">'+product.producto+'<span style="margin-left: 46em;position:absolute" class="badge badge-success badge-pill">$'+product.precio+'</span><a onClick="deleteProduct(\'' + productIndex + '\')" href="#"><i style="color:red" class="fa fa-trash"></i></a></li></ul>');
    productIndex++;
  })

}

function deleteProduct(index){
  var id= chazas[globalIndex]._id;
  console.log(index);
  var xhr;
  xhr = $.ajax({
      url: url+"/removerProducto",
      type: "POST",
      async: true, // set to false if you don't mind the page pausing while waiting for response
      cache: false,
      dataType: "json",
      data: JSON.stringify({id:id, index:index}),
      contentType: "application/json; charset=utf-8",
      success: function(data) {
          console.log(data);
          if(data.removido== 'ok'){
             reloadProducts(data.productos);
             getchazasofuser();
             toastr.success('El producto ha sido eliminado');
          }
          else{
            $('#error').modal('show');
          }
          // handle your successful response here
      },
      error: function(xhr, ajaxOptions, thrownError) {
          $('#error').modal('show');
          // handle your fail response here
      }
  });
   xhr.setRequestHeader("Access-Control-Allow-Origin: *");

  return xhr;

}

function cerrarSesion(){
  localStorage.removeItem("usuario");
  window.location.replace('index.html')
}

function iniciarRegistro(){
  $('#ingModal').modal('show');
}

function initMap(){
  var myLatLng = {lat: 4.636477, lng:  -74.083403};

  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 17,
    center: myLatLng
  });

  var marker = new google.maps.Marker({
    position: myLatLng,
    map: map,
    title: 'Arrastrame a la ubicación',
    draggable:true
  });
  google.maps.event.addListener(marker, 'dragend', function (event) {
    lat = this.getPosition().lat();
    lng = this.getPosition().lng();
    console.log(lat);
    console.log(lng);
});

}

function getchazasofuser(){
  var xhr;
  xhr = $.ajax({

      url: url+"/getchazasofuser",
      type: "POST",
      async: true, // set to false if you don't mind the page pausing while waiting for response
      cache: false,
      dataType: "json",
      data: JSON.stringify({email:usuario.email}),
      contentType: "application/json; charset=utf-8",
      success: function(data) {
                chazas =  (data.negocios);
                if(data.negocios== undefined || chazas == undefined || chazas == null|| chazas.length == 0){
                  $('#noChazas').append('<h4>Aún no estás vinculado a ninguna chaza, ponte en contacto con tu administrador para que te añada al negocio.</h4>');
                }
                mapChazas();
              // handle your successful response here
      },
      error: function(xhr, ajaxOptions, thrownError) {
          $('#noChazas').append('<h4>Aún no estás vinculado a ninguna chaza, ponte en contacto con tu administrador para que te añada al negocio.</h4>');
          // handle your fail response here
      }
  });
   xhr.setRequestHeader("Access-Control-Allow-Origin: *");

  return xhr

}


function crearNegocio(){
  var nombre =$('#nombreval').val();
  var descripcion =  $('#descripcionval').val();
  var celular =  $('#celularval').val();
  var horario =  $('#horarioval').val();
  var categoria = $('#cate').val();

  $('#errormsg').html();

  var xhr;
  xhr = $.ajax({

      url: url+"/nuevonegocio",
      type: "POST",
      async: true, // set to false if you don't mind the page pausing while waiting for response
      cache: false,
      dataType: "json",
      data: JSON.stringify({administrador: usuario.nombre+' '+usuario.apellido, email: usuario.email , categoria: categoria,
      nombre: nombre, descripcion: descripcion, celular: celular, horario:horario, latitud: lat, longitud:lng}),
      contentType: "application/json; charset=utf-8",
      success: function(data) {
          console.log(data);
          if(data.registrado== 'ok'){
            getchazasofuser();
            $('#ingModal').modal('hide');
            $('#success').modal('show');
          }
          else{
            $('#ingModal').modal('hide');
            $('#error').modal('show');
            $('#errormsg').html(data.error);
          }
          // handle your successful response here
      },
      error: function(xhr, ajaxOptions, thrownError) {
          $('#ingModal').modal('hide');
          $('#error').modal('show');
          // handle your fail response here
      }
  });
   xhr.setRequestHeader("Access-Control-Allow-Origin: *");

  return xhr;
}

</script>

<!--gmaps Js-->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjCGmQ0Uq4exrzdcL6rvxywDDOvfAu6eE&callback=initMap"></script>
