<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="icon" href="img/favicon.png" type="image/png">
        <title>ChazUN</title>
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="vendors/linericon/style.css">
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <link rel="stylesheet" href="vendors/owl-carousel/owl.carousel.min.css">
        <link rel="stylesheet" href="vendors/lightbox/simpleLightbox.css">
        <link rel="stylesheet" href="vendors/nice-select/css/nice-select.css">
        <link rel="stylesheet" href="vendors/animate-css/animate.css">
        <link rel="stylesheet" href="vendors/flaticon/flaticon.css">
        <!-- main css -->
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/responsive.css">
    </head>
    <body>

        <!--================Header Menu Area =================-->
        <header class="header_area">
            <div class="main_menu">
            	<nav class="navbar navbar-expand-lg navbar-light">
					<div class="container box_1620">
						<!-- Brand and toggle get grouped for better mobile display -->
						<a class="navbar-brand logo_h" href="index.html"><img src="logo.png" alt="" width='200em' height='90em'></a>
						<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<!-- Collect the nav links, forms, and other content for toggling -->
						<div class="collapse navbar-collapse offset" id="navbarSupportedContent">
							<ul class="nav navbar-nav menu_nav justify-content-center">
								<li class="nav-item active"><a class="nav-link" href="index.html">Inicio</a></li>
								<li class="nav-item"><a class="nav-link" href="about-us.html">Acerca de</a></li>
								<li class="nav-item submenu dropdown">
									<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">El equipo</a>
									<ul class="dropdown-menu">
										<li class="nav-item"><a class="nav-link" href="price.html">Cristian</a>
										<li class="nav-item"><a class="nav-link" href="elements.html">Diego</a></li>
                    <li class="nav-item"><a class="nav-link" href="elements.html">Esteban</a></li>
									</ul>
								</li>
								</li>
								<li class="nav-item"><a class="nav-link" href="contact.html">Contacto</a></li>
							</ul>
							<ul class="nav navbar-nav navbar-right">
								<li class="nav-item"><a href="#" class="tickets_btn">Explorar</a></li>
							</ul>
						</div>
					</div>
            	</nav>
            </div>
        </header>
        <!--================Header Menu Area =================-->

        <!--================Home Banner Area =================-->
        <section id='landing' class="home_banner_area" style='height: 900px !important;'>
            <div class="banner_inner">
				<div class="container">
					<div class="row">
						<div class="col-lg-5">
							<div class="banner_content">
								<h2>ChazUN <br />Negocios universitarios</h2>
								<p>ChazUn es una aplicación que permite...</p>
								<a class="banner_btn" href="registrarse.html">Registrarse</a>
								<a id='ingreso' onclick="ingresar()"  class="banner_btn2" href="#">Ingresar</a>
							</div>
						</div>
						<div class="col-lg-7">
							<div class="home_left_img">
								<img class="img-fluid" src="img/store.png" alt="">
							</div>
						</div>
					</div>
				</div>
            </div>
        </section>
        <!--================End Home Banner Area =================-->
        <!--================Footer Area =================-->
        <footer class="footer_area p_120">
        	<div class="container">
        		<div class="row footer_inner">
        			<div class="col-lg-5 col-sm-6">
        				<aside class="f_widget ab_widget">
        					<div class="f_title">
        						<h3>Acerca de ChazUN</h3>
        					</div>
        					<p>ChazUN es una app creada por estudiantes de la Universidad Nacional de Colombia</p>
        					<p>
Copyright &copy;<script>document.write(new Date().getFullYear());</script> | Todos los derechos reservados</a>></p>
        				</aside>
        			</div>

        			<div class="col-lg-6" style='padding-left:9em'>
                  <img src="img/escudo.png" alt="" width='400em' height='200em'>
        				<aside class="f_widget social_widget">
        					<div class="f_title">
        					</div>
        				</aside>
        			</div>
        		</div>
        	</div>
        </footer>
        <!--================End Footer Area =================-->


        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="js/jquery-3.2.1.min.js"></script>
        <script src="js/popper.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/stellar.js"></script>
        <script src="vendors/lightbox/simpleLightbox.min.js"></script>
        <script src="vendors/nice-select/js/jquery.nice-select.min.js"></script>
        <script src="vendors/isotope/imagesloaded.pkgd.min.js"></script>
        <script src="vendors/isotope/isotope-min.js"></script>
        <script src="vendors/owl-carousel/owl.carousel.min.js"></script>
        <script src="js/jquery.ajaxchimp.min.js"></script>
        <script src="vendors/counter-up/jquery.waypoints.min.js"></script>
        <script src="vendors/counter-up/jquery.counterup.min.js"></script>
        <script src="js/mail-script.js"></script>
        <!--gmaps Js-->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjCGmQ0Uq4exrzdcL6rvxywDDOvfAu6eE"></script>
        <script src="js/gmaps.min.js"></script>
        <script src="js/theme.js"></script>

        <div id="ingModal" class="modal modal-message fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <i class="fa fa-close"></i>
                        </button>
                        <h2>Ingresar a tu cuenta</h2>
                          <form class="row contact_form" action="" method="post" id="contactForm" novalidate="novalidate">
                              <div class="col-md-12 text-center">
                                  <div class="form-group">
                                      <input type="email" class="form-control" id="emailval" name="email" placeholder="Email">
                                  </div>
                                  <div class="form-group">
                                      <input type="password" class="form-control" id="contraseñaval" name="subject" placeholder="Contraseña">
                                  </div>
                              </div>

                              <div class="col-md-12 text-center">
                                  <button  onclick="validarIngreso()"  type="button" value="submit" class="btn submit_btn">Ingresar</button>
                              </div>
                          </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="error" class="modal modal-message fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <i class="fa fa-close"></i>
                        </button>
                        <h2>Lo sentimos !</h2>
                        <p>Algo salio mal</p>
                        <p id='errormsg'></p>
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>

<script>
function ingresar(){
  $('#ingModal').modal('show');
}

function validarIngreso(){
  var contraseña =$('#contraseñaval').val();
  var email =  $('#emailval').val();
  $('#errormsg').html();

  var xhr;
  xhr = $.ajax({

      url: "http://localhost:3001/ingresar",
      type: "POST",
      async: true, // set to false if you don't mind the page pausing while waiting for response
      cache: false,
      dataType: "json",
      data: JSON.stringify({email: email, password: contraseña}),
      contentType: "application/json; charset=utf-8",
      success: function(data) {
          console.log(data);
          if(data.validado== 'ok'){
            var usuario = data.usuario;
            console.log(usuario);
            $('#ingModal').modal('hide');
            $('#landing').empty();
            if(usuario.rol == 'admin'){
               localStorage.setItem("usuario", JSON.stringify(usuario));
               window.location.replace('admin.html')
            }


          }
          else{
            $('#ingModal').modal('hide');
            $('#error').modal('show');
            $('#errormsg').html(data.error);
          }
          // handle your successful response here
      },
      error: function(xhr, ajaxOptions, thrownError) {
          $('#ingModal').modal('hide');
          $('#error').modal('show');
          // handle your fail response here
      }
  });
   xhr.setRequestHeader("Access-Control-Allow-Origin: *");

  return xhr;
}

</script>
